<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>@WritersCafe208 ‚Äî Q9 Fix-It Lab</title>

  <style>
    /* ===== Writers Caf√© palette (soft, warm, readable) ===== */
    :root{
      --cream:#fbf6ef;
      --latte:#f2e6d8;
      --mocha:#3a2b23;
      --cocoa:#5a4236;
      --rose:#f7d6e6;
      --pink:#ff4fa3;
      --teal:#2fb7a3;
      --mint:#d9f4ef;
      --ink:#2b2420;
      --line:#e6d6c8;
      --shadow: 0 12px 30px rgba(58,43,35,.10);
      --radius:18px;

      --good:#1f8f4a;       /* caf√© green */
      --goodBg: rgba(31,143,74,.12);
      --bad:#d14949;        /* warm red */
      --badBg: rgba(209,73,73,.10);
      --badOutline: rgba(209,73,73,.55);
      --goodOutline: rgba(31,143,74,.55);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      background:
        radial-gradient(1200px 500px at 20% 0%, var(--rose), transparent 60%),
        radial-gradient(1200px 500px at 90% 10%, var(--mint), transparent 55%),
        linear-gradient(180deg, var(--cream), var(--latte));
      min-height:100vh;
    }

    header{
      padding:16px 18px;
      border-bottom:1px solid var(--line);
      background: rgba(251,246,239,.70);
      backdrop-filter: blur(6px);
      position: sticky;
      top:0;
      z-index:5;
    }

    .wrap{max-width:1200px;margin:0 auto}
    .brand{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:10px 12px; border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      box-shadow: 0 6px 18px rgba(58,43,35,.06);
      font-weight:700;
    }
    .pill small{font-weight:600;color:rgba(43,36,32,.70)}
    .pill .dot{width:10px;height:10px;border-radius:50%;}
    .dot.pink{background:var(--pink)}
    .dot.teal{background:var(--teal)}

    main{padding:18px}
    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin:12px 0 18px}
    .tabbtn{
      cursor:pointer;
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:14px;
      box-shadow: 0 8px 18px rgba(58,43,35,.07);
      font-weight:800;
      color:var(--mocha);
    }
    .tabbtn[aria-selected="true"]{
      outline: 2px solid rgba(255,79,163,.45);
      background: linear-gradient(180deg, #fff, rgba(247,214,230,.45));
    }

    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}

    .card{
      background:#fff;
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }

    h2,h3{margin:6px 0 10px;color:var(--mocha)}
    p{margin:8px 0; line-height:1.45}
    .muted{color:rgba(43,36,32,.70)}
    .divider{height:1px;background:var(--line);margin:12px 0}

    .btn{
      cursor:pointer;
      border:1px solid var(--line);
      padding:10px 12px;
      border-radius:14px;
      background:#fff;
      font-weight:800;
      color:var(--mocha);
    }
    .btn.primary{
      border-color: rgba(47,183,163,.55);
      background: linear-gradient(180deg, #fff, rgba(47,183,163,.18));
    }
    .btn.pink{
      border-color: rgba(255,79,163,.55);
      background: linear-gradient(180deg, #fff, rgba(255,79,163,.16));
    }
    .btn:disabled{opacity:.6; cursor:not-allowed}

    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(242,230,216,.55);
      font-weight:800;
      color:var(--cocoa);
    }
    .status.ok{background: rgba(217,244,239,.9); border-color: rgba(47,183,163,.35)}
    .status.warn{background: rgba(247,214,230,.70); border-color: rgba(255,79,163,.30)}

    /* Drag items */
    .draggable{
      cursor:grab;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(242,230,216,.35);
      box-shadow: 0 6px 12px rgba(58,43,35,.06);
      font-weight:750;
    }
    .draggable:active{cursor:grabbing}
    .draggable.selected{
      outline: 3px solid rgba(255,79,163,.40);
      background: rgba(247,214,230,.40);
    }

    /* Rationale card + slot */
    .rationaleCard{
      border:1px solid var(--line);
      border-radius: 16px;
      padding:12px;
      background: linear-gradient(180deg, rgba(247,214,230,.50), rgba(217,244,239,.25));
    }
    .rationaleCard h4{margin:0 0 8px;color:var(--mocha)}

    .slot{
      margin-top:10px;
      min-height:52px;
      border-radius:14px;
      border:2px dashed rgba(58,43,35,.18);
      background: rgba(255,255,255,.65);
      padding:8px;
      display:flex;
      align-items:center;
      gap:10px;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
    }
    .slot .placeholder{
      color:rgba(43,36,32,.55);
      font-weight:700;
    }

    /* Correct / Incorrect states for Activity 1 */
    .slot.correct{
      border: 2px solid var(--goodOutline);
      background: var(--goodBg);
    }
    .slot.incorrect{
      border: 2px solid var(--badOutline);
      background: var(--badBg);
      animation: wiggle .35s ease-in-out 0s 3;
    }
    @keyframes wiggle{
      0%{transform:translateX(0)}
      25%{transform:translateX(-3px)}
      50%{transform:translateX(3px)}
      75%{transform:translateX(-2px)}
      100%{transform:translateX(0)}
    }

    /* Activity 2 layout */
    .banks{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 980px){.banks{grid-template-columns:1fr}}
    .bank{
      border:1px solid var(--line);
      border-radius: 16px;
      padding:12px;
      background: rgba(242,230,216,.45);
    }
    .bankTitle{
      display:flex;align-items:center;gap:10px;margin-bottom:10px;
      font-weight:900;color:var(--mocha)
    }
    .badge{
      padding:6px 10px;border-radius:999px;
      background:#fff;border:1px solid var(--line);
      font-weight:900
    }
    .badge.cause{color:var(--pink)}
    .badge.effect{color:var(--teal)}
    .bankList{display:grid;gap:10px}

    .stepPanel{
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(242,230,216,.45));
    }
    .step{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:#fff;
      margin-bottom:12px;
    }
    .step h4{margin:0 0 6px;color:var(--mocha)}
    .step .directions{color:rgba(43,36,32,.75);font-weight:650}

    .dropRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    @media (max-width: 980px){.dropRow{grid-template-columns:1fr}}
    .dropBox{
      min-height:54px;
      border-radius:16px;
      border:2px dashed rgba(58,43,35,.18);
      background: rgba(255,255,255,.75);
      padding:10px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dropBox .placeholder{font-weight:800;color:rgba(43,36,32,.55)}
    .dropLabel{
      display:inline-flex;gap:8px;align-items:center;
      font-weight:950;margin-bottom:8px;color:var(--mocha)
    }
    .dotSmall{width:10px;height:10px;border-radius:50%;}
    .dotSmall.pink{background:var(--pink)}
    .dotSmall.teal{background:var(--teal)}

    .stemBlock{
      border-left: 6px solid rgba(255,79,163,.55);
      background: rgba(247,214,230,.35);
      border-radius:14px;
      padding:10px 12px;
      font-weight:800;
      color:rgba(58,43,35,.88);
      margin-top:10px;
    }
    .stemBlock.teal{
      border-left-color: rgba(47,183,163,.55);
      background: rgba(217,244,239,.35);
    }

    /* NEW: Scaffold mini-steps */
    .scaffold{
      margin-top:10px;
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      background: rgba(242,230,216,.30);
    }
    .scaffold ol{
      margin:6px 0 0 18px;
      padding:0;
      color:rgba(43,36,32,.78);
      font-weight:700;
    }
    .scaffold li{margin:6px 0}
    .keyWord{color:var(--mocha); font-weight:900}
    .lockRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px}

    textarea{
      width:100%;
      min-height:92px;
      border-radius:16px;
      border:1px solid var(--line);
      padding:10px 12px;
      font-size:15px;
      background: rgba(255,255,255,.92);
      color: var(--good);       /* NEW: green student typing */
      font-weight:800;
      resize:vertical;
    }
    textarea:read-only{
      background: rgba(217,244,239,.35);
      border-color: rgba(47,183,163,.35);
    }

    .hidden{display:none}
  </style>
</head>

<body>
<header>
  <div class="wrap brand">
    <span class="pill">‚òï <b>@WritersCafe208</b> <small>Q9 Fix-It Lab</small></span>
    <span class="pill"><span class="dot teal"></span> Goal: <small>Repair thinking (not redo the hunt)</small></span>
    <span class="pill"><span class="dot pink"></span> Time: <small>10‚Äì15 min</small></span>
  </div>
</header>

<main class="wrap">
  <div class="tabs" role="tablist" aria-label="Activities">
    <button class="tabbtn" role="tab" aria-selected="true" aria-controls="tab1" id="t1">Activity 1 ‚Äî Drag Answers into Rationale Cards</button>
    <button class="tabbtn" role="tab" aria-selected="false" aria-controls="tab2" id="t2">Activity 2 ‚Äî Cause Bank + Effect Bank ‚Üí Topic</button>
  </div>

  <!-- ===================== TAB 1 ===================== -->
  <section id="tab1" role="tabpanel" aria-labelledby="t1">
    <div class="grid">
      <div class="card">
        <h2>Benchmark Question (Q9)</h2>
        <p><b>How does the use of a cause-and-effect structure in paragraphs 2‚Äì3</b> help support the topic of the article?</p>

        <div class="divider"></div>
        <h3>Answer Choices (Drag OR Click-to-Move)</h3>
        <p class="muted">
          Drag each choice into a rationale slot. Or: <b>click an answer</b> to pick it up, then <b>click a slot</b> to drop it.
        </p>

        <div id="answerDeck" class="bankList"></div>

        <div class="divider"></div>
        <div class="muted"><b>Tip:</b> We‚Äôre not asking ‚ÄúWhich answer sounds nice?‚Äù We‚Äôre asking ‚ÄúWhich answer matches what the <i>structure</i> is doing?‚Äù</div>
      </div>

      <div class="card">
        <h2>Rationale Cards (Drop Zones)</h2>
        <p class="muted">Each card already has the reasoning. Your job is to match the answer choice to the right rationale.</p>

        <div id="rationaleCards" class="bankList"></div>

        <div class="divider"></div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <button class="btn primary" id="checkTab1">Check Matches</button>
          <button class="btn" id="resetTab1">Reset</button>
          <span id="statusTab1" class="tag status warn">Not checked yet</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ===================== TAB 2 ===================== -->
  <section id="tab2" role="tabpanel" aria-labelledby="t2" class="hidden">
    <div class="grid">
      <!-- Left: banks -->
      <div class="card">
        <h2>Cause Bank + Effect Bank</h2>
        <p class="muted">Drag a cause and an effect into Box 1. Then do it again for Box 2. After that, combine both into one final statement that answers Q9.</p>

        <div class="banks">
          <div class="bank">
            <div class="bankTitle"><span class="badge cause">CAUSE</span> Choose a reason / why</div>
            <div class="bankList" id="causeBank"></div>
          </div>

          <div class="bank">
            <div class="bankTitle"><span class="badge effect">EFFECT</span> Choose a result / what happened</div>
            <div class="bankList" id="effectBank"></div>
          </div>
        </div>
      </div>

      <!-- Right: directions + boxes -->
      <div class="card stepPanel">
        <h2>Build the Reasoning (2 Boxes ‚Üí 1 Answer)</h2>

        <!-- Box 1 -->
        <div class="step">
          <h4>Box 1</h4>
          <div class="directions">1) Drag a <b>CAUSE</b>. 2) Drag an <b>EFFECT</b>. 3) Explain how this cause/effect helps clarify the topic of <b>community artwork</b>.</div>

          <div class="dropRow">
            <div>
              <div class="dropLabel"><span class="dotSmall pink"></span> Drag a CAUSE here</div>
              <div class="dropBox" id="b1Cause"><span class="placeholder">Drop CAUSE</span></div>
            </div>
            <div>
              <div class="dropLabel"><span class="dotSmall teal"></span> Drag an EFFECT here</div>
              <div class="dropBox" id="b1Effect"><span class="placeholder">Drop EFFECT</span></div>
            </div>
          </div>

          <div class="scaffold">
            <b>Quick scaffold (what your sentence should do):</b>
            <ol>
              <li>Say the <span class="keyWord">CAUSE</span> (why).</li>
              <li>Say the <span class="keyWord">EFFECT</span> (what happened).</li>
              <li>Say how this connects to the <span class="keyWord">TOPIC</span>: community artwork.</li>
            </ol>
          </div>

          <div class="stemBlock">
            <div><b>Sentence stem:</b></div>
            <div>
              Because <u>__________</u>, the result is <u>__________</u>.
              This supports the topic of community artwork because <u>__________</u>.
            </div>
          </div>

          <div class="lockRow">
            <button class="btn pink" data-lock="b1Explain" id="lockB1">üîí Lock Box 1</button>
            <span class="muted">Lock it if you‚Äôre done and want to protect your work.</span>
          </div>
          <textarea id="b1Explain" aria-label="Box 1 explanation"></textarea>
        </div>

        <!-- Box 2 -->
        <div class="step">
          <h4>Box 2</h4>
          <div class="directions">Pick a <b>different</b> cause and effect. Explain how this second relationship also clarifies the topic of community artwork.</div>

          <div class="dropRow">
            <div>
              <div class="dropLabel"><span class="dotSmall pink"></span> Drag a CAUSE here</div>
              <div class="dropBox" id="b2Cause"><span class="placeholder">Drop CAUSE</span></div>
            </div>
            <div>
              <div class="dropLabel"><span class="dotSmall teal"></span> Drag an EFFECT here</div>
              <div class="dropBox" id="b2Effect"><span class="placeholder">Drop EFFECT</span></div>
            </div>
          </div>

          <div class="scaffold">
            <b>Quick scaffold (keep it simple):</b>
            <ol>
              <li>Start with ‚ÄúAnother cause is‚Ä¶‚Äù</li>
              <li>Then ‚Äúwhich led to‚Ä¶‚Äù</li>
              <li>Finish with how it supports the topic.</li>
            </ol>
          </div>

          <div class="stemBlock teal">
            <div><b>Sentence stem:</b></div>
            <div>
              Another cause is <u>__________</u>, which led to <u>__________</u>.
              This reinforces the topic of community artwork by showing <u>__________</u>.
            </div>
          </div>

          <div class="lockRow">
            <button class="btn pink" data-lock="b2Explain" id="lockB2">üîí Lock Box 2</button>
            <span class="muted">Lock it when you‚Äôre done.</span>
          </div>
          <textarea id="b2Explain" aria-label="Box 2 explanation"></textarea>
        </div>

        <!-- Final synthesis -->
        <div class="step">
          <h4>Final: One statement that answers Q9</h4>
          <div class="directions"><b>Combine Box 1 + Box 2</b> into one strong statement:</div>

          <div class="scaffold">
            <b>Final sentence goal:</b>
            <ol>
              <li>Mention the author‚Äôs <span class="keyWord">cause-and-effect structure</span>.</li>
              <li>Explain how it shows <span class="keyWord">why the artist created the work this way</span>.</li>
              <li>Connect to the <span class="keyWord">topic</span> (community artwork).</li>
            </ol>
          </div>

          <div class="stemBlock">
            <div><b>Sentence stem (final answer):</b></div>
            <div>
              The author‚Äôs use of cause-and-effect structure supports the topic of community artwork by showing that
              <u>__________</u>, which led to <u>__________</u>.
            </div>
          </div>

          <div class="lockRow">
            <button class="btn pink" data-lock="finalAnswer" id="lockFinal">üîí Lock Final Answer</button>
            <span class="muted">Lock it when you‚Äôre satisfied.</span>
          </div>
          <textarea id="finalAnswer" aria-label="Final synthesis answer"></textarea>

          <div class="divider"></div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
            <button class="btn primary" id="selfCheck">Self-Check</button>
            <button class="btn" id="resetTab2">Reset Activity</button>
            <span id="statusTab2" class="tag status warn">Not checked yet</span>
          </div>

          <p class="muted" id="selfNote"></p>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
/* ===================== Tabs ===================== */
const tabs = [
  {btn: document.getElementById('t1'), panel: document.getElementById('tab1')},
  {btn: document.getElementById('t2'), panel: document.getElementById('tab2')},
];
tabs.forEach((t, idx) => {
  t.btn.addEventListener('click', () => {
    tabs.forEach((x, i) => {
      x.btn.setAttribute('aria-selected', i === idx ? 'true' : 'false');
      x.panel.classList.toggle('hidden', i !== idx);
    });
  });
});

/* ===================== Helpers ===================== */
function setStatus(id, text, ok=false){
  const el = document.getElementById(id);
  el.textContent = text;
  el.classList.remove('ok','warn');
  el.classList.add(ok ? 'ok' : 'warn');
}

/* ===================== Activity 1 ‚Äî Click-to-move + check colors + wiggle ===================== */
const answers = [
  {id:'A', text:'It shows that the people of the city have a deep appreciation for their culture and history.'},
  {id:'B', text:'It demonstrates why people from the community were willing to share their stories.'},
  {id:'C', text:'It emphasizes the importance of the materials used by the artist to build the sculpture.'},
  {id:'D', text:'It explains why the artist was inspired to create the sculpture in the way that she did.'},
];

const rationaleCardsData = [
  { id:'card1', title:'‚ÄúTrue-sounding, but NOT what this question asks.‚Äù',
    rationale:'This answer may sound true about the article, but it does not explain how the cause-and-effect structure in paragraphs 2‚Äì3 supports the topic.',
    correct:'A' },
  { id:'card2', title:'‚ÄúWrong focus.‚Äù',
    rationale:'This answer focuses on the community‚Äôs reasons instead of the artist‚Äôs inspiration and design choices, which is what the structure explains here.',
    correct:'B' },
  { id:'card3', title:'‚ÄúDetail distraction.‚Äù',
    rationale:'This answer shifts attention to materials. Paragraphs 2‚Äì3 use cause/effect to explain reasons and inspiration, not construction supplies.',
    correct:'C' },
  { id:'card4', title:'‚úÖ ‚ÄúMatches structure + topic.‚Äù',
    rationale:'Correct: the cause-and-effect structure explains what the artist saw/understood and how that led her to create the sculpture in a specific way.',
    correct:'D' },
];

const answerDeck = document.getElementById('answerDeck');
const rationaleCards = document.getElementById('rationaleCards');

let selectedChipId = null;

function clearSelectedChip(){
  document.querySelectorAll('.draggable.selected').forEach(x => x.classList.remove('selected'));
  selectedChipId = null;
}

function makeAnswerChip(a){
  const d = document.createElement('div');
  d.className = 'draggable';
  d.draggable = true;
  d.id = 'ans_' + a.id;
  d.dataset.answerId = a.id;
  d.innerHTML = `<b>${a.id}.</b> ${a.text}`;

  // Drag support
  d.addEventListener('dragstart', (e)=> {
    e.dataTransfer.setData('text/plain', d.id);
  });

  // Click-to-pick-up support
  d.addEventListener('click', () => {
    if(selectedChipId === d.id){
      clearSelectedChip();
      return;
    }
    clearSelectedChip();
    selectedChipId = d.id;
    d.classList.add('selected');
  });

  return d;
}

function makeRationaleCard(c){
  const wrap = document.createElement('div');
  wrap.className = 'rationaleCard';
  wrap.innerHTML = `
    <h4>${c.title}</h4>
    <div class="muted">${c.rationale}</div>
    <div class="slot" data-correct="${c.correct}">
      <span class="placeholder">Drop (or click-to-move) the matching answer choice here</span>
    </div>
  `;

  const slot = wrap.querySelector('.slot');

  // Allow drag drop
  slot.addEventListener('dragover', e => e.preventDefault());
  slot.addEventListener('drop', e => {
    e.preventDefault();
    const id = e.dataTransfer.getData('text/plain');
    const chip = document.getElementById(id);
    if(!chip) return;
    placeChipInSlot(chip, slot);
  });

  // Allow click-to-place: if a chip is selected, clicking the slot drops it here
  slot.addEventListener('click', () => {
    if(!selectedChipId) return;
    const chip = document.getElementById(selectedChipId);
    if(!chip) return;
    placeChipInSlot(chip, slot);
    clearSelectedChip();
  });

  return wrap;
}

function placeChipInSlot(chip, slot){
  // Keep only one chip per slot; return existing to deck
  const existing = slot.querySelector('.draggable');
  if(existing) answerDeck.appendChild(existing);

  // Remove placeholder
  const ph = slot.querySelector('.placeholder');
  if(ph) ph.remove();

  slot.appendChild(chip);

  // Clear any previous correctness visuals (student will re-check)
  slot.classList.remove('correct','incorrect');
  setStatus('statusTab1', 'Placed. Now click Check Matches.', false);
}

function resetTab1(){
  clearSelectedChip();
  answerDeck.innerHTML = '';
  rationaleCards.innerHTML = '';
  answers.forEach(a => answerDeck.appendChild(makeAnswerChip(a)));
  rationaleCardsData.forEach(c => rationaleCards.appendChild(makeRationaleCard(c)));
  setStatus('statusTab1', 'Not checked yet', false);
}

document.getElementById('checkTab1').addEventListener('click', () => {
  clearSelectedChip();
  const slots = rationaleCards.querySelectorAll('.slot');
  let correctCount = 0;

  // clear old states
  slots.forEach(s => s.classList.remove('correct','incorrect'));

  slots.forEach(s => {
    const chip = s.querySelector('.draggable');
    const correct = s.dataset.correct;

    if(chip && chip.dataset.answerId === correct){
      s.classList.add('correct');
      correctCount++;
    } else {
      // Mark incorrect (wiggle + red) ONLY if something is placed or it was attempted
      // If empty, still mark incorrect so they notice it needs a match
      s.classList.add('incorrect');
    }
  });

  if(correctCount === slots.length){
    setStatus('statusTab1', 'Perfect ‚Äî everything is correct ‚úÖ', true);
  } else {
    setStatus('statusTab1', `${correctCount}/${slots.length} correct ‚Äî move the red wiggling one(s) and check again.`, false);
  }
});

document.getElementById('resetTab1').addEventListener('click', resetTab1);
resetTab1();

/* ===================== Activity 2 ‚Äî Cause/effect banks + lock buttons + green text ===================== */
const causes = [
  {id:'c1', text:'The artist noticed difficult conditions affecting some Hispanic communities.'},
  {id:'c2', text:'She wanted to create public art that reflects love and respect for the people.'},
  {id:'c3', text:'She wanted to celebrate San Antonio‚Äôs history from the point of view of the people who lived it.'},
  {id:'c4', text:'She invited community members to share stories and cultural experiences.'}
];

const effects = [
  {id:'e1', text:'She led public chats where community members shared family histories and cultures.'},
  {id:'e2', text:'Those stories became designs that represented many cultures and lifestyles.'},
  {id:'e3', text:'The sculptures were created in a way meant to include many voices and identities.'},
  {id:'e4', text:'The final artwork represented community experiences through a shared public project.'}
];

const causeBank = document.getElementById('causeBank');
const effectBank = document.getElementById('effectBank');

function makeStrip(item, type){
  const d = document.createElement('div');
  d.className = 'draggable';
  d.draggable = true;
  d.id = `${type}_${item.id}`;
  d.dataset.type = type;     // 'cause' or 'effect'
  d.dataset.itemId = item.id;
  d.textContent = item.text;
  d.addEventListener('dragstart', (e)=> {
    e.dataTransfer.setData('text/plain', d.id);
  });
  return d;
}

function setDropBox(boxEl, expectedType){
  boxEl.addEventListener('dragover', e => e.preventDefault());
  boxEl.addEventListener('drop', e => {
    e.preventDefault();
    const id = e.dataTransfer.getData('text/plain');
    const strip = document.getElementById(id);
    if(!strip) return;

    if(strip.dataset.type !== expectedType){
      setStatus('statusTab2', `That was a ${strip.dataset.type.toUpperCase()}. Drop a ${expectedType.toUpperCase()} here.`, false);
      return;
    }

    // Only one strip per drop box
    const existing = boxEl.querySelector('.draggable');
    if(existing){
      (existing.dataset.type === 'cause' ? causeBank : effectBank).appendChild(existing);
    }

    const ph = boxEl.querySelector('.placeholder');
    if(ph) ph.remove();

    boxEl.appendChild(strip);
    setStatus('statusTab2', 'Good pick. Keep going.', true);
  });
}

setDropBox(document.getElementById('b1Cause'), 'cause');
setDropBox(document.getElementById('b1Effect'), 'effect');
setDropBox(document.getElementById('b2Cause'), 'cause');
setDropBox(document.getElementById('b2Effect'), 'effect');

function resetTab2(){
  causeBank.innerHTML = '';
  effectBank.innerHTML = '';
  causes.forEach(c => causeBank.appendChild(makeStrip(c,'cause')));
  effects.forEach(e => effectBank.appendChild(makeStrip(e,'effect')));

  const drops = [
    {id:'b1Cause', label:'Drop CAUSE'},
    {id:'b1Effect', label:'Drop EFFECT'},
    {id:'b2Cause', label:'Drop CAUSE'},
    {id:'b2Effect', label:'Drop EFFECT'},
  ];
  drops.forEach(d => {
    const el = document.getElementById(d.id);
    const strip = el.querySelector('.draggable');
    if(strip) (strip.dataset.type === 'cause' ? causeBank : effectBank).appendChild(strip);
    el.innerHTML = `<span class="placeholder">${d.label}</span>`;
  });

  document.getElementById('b1Explain').readOnly = false;
  document.getElementById('b2Explain').readOnly = false;
  document.getElementById('finalAnswer').readOnly = false;

  document.getElementById('b1Explain').value = '';
  document.getElementById('b2Explain').value = '';
  document.getElementById('finalAnswer').value = '';
  document.getElementById('selfNote').textContent = '';

  document.getElementById('lockB1').textContent = 'üîí Lock Box 1';
  document.getElementById('lockB2').textContent = 'üîí Lock Box 2';
  document.getElementById('lockFinal').textContent = 'üîí Lock Final Answer';

  setStatus('statusTab2', 'Not checked yet', false);
}

document.getElementById('resetTab2').addEventListener('click', resetTab2);
resetTab2();

/* Lock buttons */
function toggleLock(textareaId, btnId){
  const ta = document.getElementById(textareaId);
  const btn = document.getElementById(btnId);
  ta.readOnly = !ta.readOnly;
  btn.textContent = ta.readOnly ? 'üîì Unlock (edit)' : btn.textContent.replace('üîì Unlock (edit)','üîí Lock');
  if(!ta.readOnly) btn.textContent = btn.textContent.includes('Lock') ? btn.textContent : 'üîí Lock';
}
document.getElementById('lockB1').addEventListener('click', () => {
  const ta = document.getElementById('b1Explain');
  ta.readOnly = !ta.readOnly;
  document.getElementById('lockB1').textContent = ta.readOnly ? 'üîì Unlock Box 1 (edit)' : 'üîí Lock Box 1';
});
document.getElementById('lockB2').addEventListener('click', () => {
  const ta = document.getElementById('b2Explain');
  ta.readOnly = !ta.readOnly;
  document.getElementById('lockB2').textContent = ta.readOnly ? 'üîì Unlock Box 2 (edit)' : 'üîí Lock Box 2';
});
document.getElementById('lockFinal').addEventListener('click', () => {
  const ta = document.getElementById('finalAnswer');
  ta.readOnly = !ta.readOnly;
  document.getElementById('lockFinal').textContent = ta.readOnly ? 'üîì Unlock Final (edit)' : 'üîí Lock Final Answer';
});

document.getElementById('selfCheck').addEventListener('click', () => {
  const final = (document.getElementById('finalAnswer').value || '').toLowerCase();
  const note = document.getElementById('selfNote');

  const hasWhy = final.includes('why') || final.includes('because') || final.includes('led') || final.includes('so');
  const hasArtist = final.includes('artist');
  const hasTopic = final.includes('community') || final.includes('artwork') || final.includes('public art');

  if(hasWhy && hasArtist && hasTopic){
    setStatus('statusTab2', 'Looks aligned ‚Äî you connected WHY ‚Üí what happened ‚Üí topic ‚úÖ', true);
    note.textContent = "‚úÖ Quick check: Your sentence should show WHY the artist created it this way (not materials; not just culture).";
  } else {
    setStatus('statusTab2', 'Almost ‚Äî add WHY + artist + topic.', false);
    note.textContent = "‚ö†Ô∏è Add missing pieces: (1) WHY (cause), (2) what happened (effect), (3) how that supports the topic of community artwork.";
  }
});
</script>
</body>
</html>
